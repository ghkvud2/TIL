### 1. 쓰레드란?

- 하나의 프로세스에서 실제로 작업을 수행하는 또 다른 처리 흐름이라고 할 수 있다.
- `워드 프로세서`의 경우 입력을 지원하는 스레드, 출력을 지원하는 스레드처럼 여러 개의 스레드가 있는데 이를 `다중 쓰레드`라고 한다.
- 실제로 `컨테스트 스위치`의 단위는 `프로세스` 단위가 아니고 `쓰레드`단위이다.

#### 1.1 메모리 구조 관점에서 본 프로세스와 쓰레드

- 자식 프로세스가 생성되고 난 다음에는 부모 프로세스가 가진 핸들 테이블은 상속되지만 `code / data / stack/ heap 영역`은 독립적으로 생성된다.
- 즉, 프로세스간에 데이터를 주고 받기 위해서는  `IPC (Inter Process Communication)`이 필요하다.
- 하지만,  프로세스가 쓰레드 A와 B를 생성하는 경우에는 쓰레드를 생성할 때 마다 해당 쓰레드를 위한 `stack 영역`만이 새로 생성될 뿐, 나머지 `data / heap / code ` 부모 프로세스 영역을 공유하게 된다.



#### 1.2 프로세스 스위칭 vs 쓰레드 스위칭

- 프로세스의 경우, `컨텍스트 스위칭`의 오버헤드가 클 수 밖에 없다.
- 그 이유는 CPU는 내부적으로 캐시를 사용하는데, `프로세스`간에 공유하고 있는 데이터가 없으므로 `컨텍스트 스위칭`을 위해서는 기존에 캐시에 저장된 데이터를 모두 교체해야만 한다.
- 반면, 쓰레드의 경우에는 메모리를 공유하고 있기 때문에 캐시안에 있는 데이터 모두를  비워버릴 필요가 없기 때문에, `컨텍스트 스위칭`이 비교적 빠르다.



### 2. 프로세스 동기화

- 프로세스간의 서로 메시지를 주고받고, 프로세스 내부에서는 쓰레드끼리 자원을 공유하면서 `동기화`에 대한 문제가 발생할 수 있다.
- 즉, 공유된 자원에 여러 프로세스와 여러 쓰레드가 동시에 접근하면서 발생하는 문제가 발생한다.
- 이 문제를 해결하기 위해, `유저 동기화` 방법과 `커널 동기화` 방법이 있는데, `유저 동기화`는 임계영역, `커널 동기화`는 뮤텍스, 세마포어가 있다.



#### 2.1 임계구역 문제 (Critical Section Problem)

- `Bank Account` 문제를 살펴보면 `balance += amount` 와 같은 연산을 수행하는 것을 알 수 있다.
- 위와 같은 코드를 `어셈블리어`로 변환하면, 여러 개의 명령어로 수행되는데 각각의 명령어 사이에서 `컨텍스트 스위칭`이 발생할 수 있고, 이러한 이유 때문에 공유된 자원의 일관성이 무너질 수 있다.
- 즉, 멀티 프로세스(쓰레드) 환경에서 둘 이상의 프로세스가 동시에 접근해서는 안되는 공유 자원의 코드 영역을 `임계 구역`이라고 한다.



#### 2.2 임계구역 문제를 해결하기 위한 세 가지 조건

1. 상호 배제 (Mutual Exclusion)
   - 하나의 프로세스가 임계구역에 들어가 있으면, 다른 프로세스는 들어갈 수 없다.
2. 진행 (Progress)
   - 임계구역에 들어간 프로세스가 없다면, 어느 프로세스가 들어갈 것인지 적절히 선택해야한다.
3. 한정 대기 (Bounded Waiting)
   - 기아상태를 방지하기 위해, 한 번 들어갔다가 나온 프로세스는 다음에 들어갈 때 제한을 준다.
   - 즉, 어느 프로세스라도 정해진 시간내에 언젠가는 `임계 구역`에 들어가야 한다는 조건이다.

#### 2.3 피터슨 알고리즘







